var Routing=function(n,t){var r=this,u=[],f=null,c={initial:{},pushState:function(t,i,u){r.history.supported?e(u)&&n.history.pushState(t,i,u):r.history.fallback&&(n.location.hash="#"+u)},popState:function(){var n=!r.history.initial.popped&&location.href==r.history.initial.URL;(r.history.initial.popped=!0,n)||e(t.location.pathname)},listen:function(t){var u,e,f;if(r.history.supported=!!(n.history&&n.history.pushState),r.history.fallback=t,r.history.supported)r.history.initial.popped="state"in n.history,r.history.initial.URL=location.href,n.onpopstate=r.history.popState;else if(r.history.fallback){for(u=0,e=i.defined.length;u<e;u++)f=i.defined[u],f.path.charAt(0)!="#"&&(f.path="#"+f.path);h()}}},o=!1,l=function(n){var t=this;t.path=n;t.action=null;t.doBefore=[];t.doLeaving=null;t.fromCache=!1;t.params={};t.segments=[];t.mandatory=0;t.mandWithOpts=0;t.before=function(n){return Object.prototype.toString.call(n)==="[object Array]"?t.doBefore=t.doBefore.concat(n):t.doBefore.push(n),t};t.leaving=function(n){return t.doLeaving=n,t};t.partition=function(){for(var t=[],n=[],u=/\(([^}]+?)\)/g,r,i=0;r=u.exec(this.path);)t.push(r[1]);for(n.push(this.path.split("(")[0]);i<t.length;i++)n.push(n[n.length-1]+t[i]);return n};t.run=function(){for(var f=!1,n=0,s=i.defined.length,e,r,o,h;n<s;n++)if(i.defined[n].path===t.path){if(r=i.defined[n],r.doBefore.length>0)for(n=0,s=r.doBefore.length;n<s;n++)if(e=r.doBefore[n].apply(t,[]),e===!1){f=!0;break}if(!f&&u.length>0)for(o=0,h=u.length;o<h;o++)if(e=u[o].apply(t,[]),e===!1){f=!0;break}f||typeof r.action!="function"||r.action();break}};t.to=function(n){return t.action=n,t}},i={before:function(n){return Object.prototype.toString.call(n)==="[object Array]"?u=u.concat(n):u.push(n),this},cache:[],current:null,defined:[],fallback:null,leaving:function(n){return f=n,this},previous:null,root:null},s=function(n,t){var f,r,e,u;if(i.current!==null&&i.current.path===n.path){f=i.current.params;for(r in t)e=t[r].value,u=f[r],t[r].hasChanged=typeof u!="undefined"?u.value!==e:!0}n.params=t},e=function(t){var r=t.split("/");if(r.pop()==="refresh")return n.location.hash=r.join("/"),o=!0,!1;if(i.current===null||i.current.path!==t||o){if(i.previous=i.current,i.current=y(t),o=!1,i.previous&&i.previous.doLeaving!==null&&typeof i.previous.doLeaving=="function"&&i.previous.doLeaving(),f!==null&&typeof f=="function"&&f(),i.current!==null)return i.current.run(),!0;i.fallback!==null&&i.fallback()}return!0},a=function(n){i.fallback=n},h=function(){var r=function(){e(location.hash)};location.hash===""&&i.root!==null&&(location.hash=i.root);"onhashchange"in n&&(!t.documentMode||t.documentMode>=8)?n.onhashchange=r:setInterval(e,50);location.hash!==""&&r()},v=function(n){for(var t=0,f=i.defined.length;t<f;t++)if(i.defined[t].path===n)return i.defined[t];for(var e=n.slice(1).split(/[/|\(/?]+/),r=new l(n),t=0,f=e.length;t<f;t++){var o=e[t],u=k(o),s=b(o,u);r.segments.push({segment:s,type:u});(u===0||u===1)&&r.mandatory++;r.mandWithOpts++}return i.defined.push(r),i.defined.sort(d),r},y=function(n){for(var f,h,t,r=0,c=i.cache.length;r<c;r++)if(i.cache[r].path===n)return t=i.cache[r].mappedTo,s(t,i.cache[r].params),t.fromCache=!0,t;for(var r=0,c=i.defined.length,e=n.slice(1).split("/");r<c;r++)if(t=i.defined[r],!(e.length<t.mandatory)&&!(e.length>t.mandWithOpts)){for(var l=!0,o={},u=0,a=t.segments.length;u<a;u++)if(f=t.segments[u],h=e[u],f.type!==0)o[f.segment]={value:h,hasChanged:!0};else if(f.segment!==h){l=!1;break}if(l)return i.cache.push({params:o,path:n,mappedTo:t}),t.fromCache=!1,s(t,o),t}return null},p=function(){var t=i!==null&&i.current!==null?i.current.split("/"):[];return t.push("refresh"),n.location.hash=t.join("/"),!0},w=function(n){i.root=n},b=function(n,t){switch(t){case 1:return n.slice(1);case 2:return n.substr(1,n.length-2);default:return n}},k=function(n){return n.charAt(0)===":"?n.charAt(n.length-1)===")"?2:1:0},d=function(n,t){return n.mandWithOpts<t.mandWithOpts?-1:t.mandWithOpts<n.mandWithOpts?1:n.mandatory<t.mandatory?-1:n.mandatory>t.mandatory?1:0};return{version:"0.9.0",map:v,root:w,fallback:a,history:c,listen:h,refresh:p,routes:i}}(window,document);
//# sourceMappingURL=routing.min.js.map
