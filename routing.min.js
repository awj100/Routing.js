/*
Routing.js Â© Andrew Jameson, 2014, and licensed under the MIT license.
Routing.js is hosted at https://github.com/awj100/Routing.js
Routing.js was forked from PathJS, https://github.com/mtrpcic/pathjs
*/
var Routing=function(a,b){var c=this,d=[],e=null,f={initial:{},pushState:function(b,d,e){c.history.supported?k(e)&&a.history.pushState(b,d,e):c.history.fallback&&(a.location.hash="#"+e)},popState:function(){var a=!c.history.initial.popped&&location.href==c.history.initial.URL;c.history.initial.popped=!0,a||k(b.location.pathname)},listen:function(b){if(c.history.supported=!(!a.history||!a.history.pushState),c.history.fallback=b,c.history.supported)c.history.initial=c.history.initial||{},c.history.initial.popped="state"in a.history,c.history.initial.URL=location.href,a.onpopstate=c.history.popState;else if(c.history.fallback){for(var d=0,e=i.defined.length;d<e;d++){var f=i.defined[d];"#"!=f.path.charAt(0)&&(f.path="#"+f.path)}m()}}},g=!1,h=function(a){var b=this;b.action=null,b.doBefore=[],b.doLeaving=null,b.fromCache=!1,b.mandatory=0,b.mandWithOpts=0,b.params={},b.path=a,b.segments=[],b.before=function(a){return"[object Array]"===Object.prototype.toString.call(a)?b.doBefore=b.doBefore.concat(a):b.doBefore.push(a),b},b.leaving=function(a){return b.doLeaving=a,b},b.run=function(){for(var f,g,a=!1,c=0,e=i.defined.length;c<e;c++)if(i.defined[c].path===b.path){if(g=i.defined[c],g.doBefore.length>0)for(c=0,e=g.doBefore.length;c<e;c++)if(f=g.doBefore[c].apply(b,[]),f===!1){a=!0;break}if(!a&&d.length>0)for(var h=0,j=d.length;h<j;h++)if(f=d[h].apply(b,[]),f===!1){a=!0;break}a||"function"!=typeof g.action||g.action();break}},b.to=function(a){return b.action=a,b}},i={before:function(a){return"[object Array]"===Object.prototype.toString.call(a)?d=d.concat(a):d.push(a),this},cache:[],current:null,defined:[],fallback:null,leaving:function(a){return e=a,this},previous:null,root:null},j=function(a,b){if(null!==i.current&&i.current.path===a.path){var c=i.current.params;for(var d in b){var e=b[d].value,f=c[d];b[d].hasChanged="undefined"==typeof f||f.value!==e}}a.params=b},k=function(b){var c=b.split("/");if("refresh"===c.pop())return a.location.hash=c.join("/"),g=!0,!1;if(b=b.replace(/#!?\/?/,""),null===i.current||i.current.path!==b||g){if(i.previous=i.current,i.current=o(b),g=!1,i.previous&&null!==i.previous.doLeaving&&"function"==typeof i.previous.doLeaving&&i.previous.doLeaving(),null!==e&&"function"==typeof e&&e(),null!==i.current)return i.current.run(),!0;null!==i.fallback&&i.fallback()}return!0},l=function(a){i.fallback=a},m=function(){var c=function(){k(a.location.hash)};""===a.location.hash&&null!==i.root&&(a.location.hash=i.root),"onhashchange"in a&&(!b.documentMode||b.documentMode>=8)?a.onhashchange=c:setInterval(c,50),""!==a.location.hash&&k(a.location.hash)},n=function(a){a=a.replace(/#!?\/?/,"");for(var b=0,c=i.defined.length;b<c;b++)if(i.defined[b].path===a)return i.defined[b];for(var d=a.split(/[\/|\(\/?]+/),e=new h(a),b=0,c=d.length;b<c;b++){var f=d[b],g=s(f),j=r(f,g);e.segments.push({segment:j,type:g}),0!==g&&1!==g||e.mandatory++,e.mandWithOpts++}return i.defined.push(e),i.defined.sort(t),e},o=function(a){for(var b,c=0,d=i.cache.length;c<d;c++)if(i.cache[c].path===a)return b=i.cache[c].mappedTo,j(b,i.cache[c].params),b.fromCache=!0,b;for(var c=0,d=i.defined.length,e=a.split("/");c<d;c++)if(b=i.defined[c],!(e.length<b.mandatory||e.length>b.mandWithOpts)){for(var f=!0,g={},h=0,k=b.segments.length;h<k;h++){var l=b.segments[h],m=e[h];if(0!==l.type)g[l.segment]={value:m,hasChanged:!0};else if(l.segment!==m){f=!1;break}}if(f)return i.cache.push({params:g,path:a,mappedTo:b}),b.fromCache=!1,j(b,g),b}return null},p=function(){var b=null!==i&&null!==i.current?i.current.split("/"):[];return b.push("refresh"),a.location.hash=b.join("/"),!0},q=function(a){i.root=a},r=function(a,b){switch(b){case 1:return a.slice(1);case 2:return a.substr(1,a.length-2);default:return a}},s=function(a){return":"===a.charAt(0)?")"===a.charAt(a.length-1)?2:1:0},t=function(b,c){return b.mandWithOpts<c.mandWithOpts?-1:c.mandWithOpts<b.mandWithOpts?1:b.mandatory<c.mandatory?-1:b.mandatory>c.mandatory?1:0};return{version:"0.9.2",map:n,root:q,fallback:l,history:f,listen:m,refresh:p,routes:i}}(window,document);
//# sourceMappingURL=routing.min.js.map
